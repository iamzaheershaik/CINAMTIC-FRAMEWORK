<main class="h-full overflow-y-auto text-gray-100 flex flex-col items-center p-4 sm:p-8 font-sans">
  <div class="w-full max-w-4xl mx-auto">
    
    @if (activeFramework() !== 'pro-guide') {
      <!-- Header -->
      <header class="text-center mb-8">
        <h1 class="text-4xl sm:text-5xl font-bold text-white mb-2">
          AI Prompt Generator
        </h1>
        @if (activeFramework() === 'cinematic') {
          <p class="text-lg text-gray-400">
            Transform simple ideas into detailed video prompts with the CINEMATIC framework.
          </p>
        } @else if (activeFramework() === 'articulated') {
          <p class="text-lg text-gray-400">
            Craft revolutionary AI animation prompts with the ARTICULATED framework.
          </p>
        } @else {
          <p class="text-lg text-gray-400">
            Produce stunning CGI product commercials with the PHOTOREAL framework.
          </p>
        }
      </header>
    }

    <!-- Framework Tabs -->
    <div class="mb-8 flex justify-center border-b border-gray-700">
      <button 
        (click)="selectFramework('cinematic')"
        class="py-4 px-6 block hover:text-purple-300 focus:outline-none border-b-2 font-medium transition duration-200"
        [class.text-purple-400]="activeFramework() === 'cinematic'"
        [class.border-purple-400]="activeFramework() === 'cinematic'"
        [class.text-gray-400]="activeFramework() !== 'cinematic'"
        [class.border-transparent]="activeFramework() !== 'cinematic'">
        CINEMATIC
      </button>
      <button 
        (click)="selectFramework('articulated')"
        class="py-4 px-6 block hover:text-purple-300 focus:outline-none border-b-2 font-medium transition duration-200"
        [class.text-purple-400]="activeFramework() === 'articulated'"
        [class.border-purple-400]="activeFramework() === 'articulated'"
        [class.text-gray-400]="activeFramework() !== 'articulated'"
        [class.border-transparent]="activeFramework() !== 'articulated'">
        ARTICULATED
      </button>
      <button 
        (click)="selectFramework('photoreal')"
        class="py-4 px-6 block hover:text-purple-300 focus:outline-none border-b-2 font-medium transition duration-200"
        [class.text-purple-400]="activeFramework() === 'photoreal'"
        [class.border-purple-400]="activeFramework() === 'photoreal'"
        [class.text-gray-400]="activeFramework() !== 'photoreal'"
        [class.border-transparent]="activeFramework() !== 'photoreal'">
        PHOTOREAL
      </button>
      <button 
        (click)="selectFramework('pro-guide')"
        class="py-4 px-6 block hover:text-purple-300 focus:outline-none border-b-2 font-medium transition duration-200"
        [class.text-purple-400]="activeFramework() === 'pro-guide'"
        [class.border-purple-400]="activeFramework() === 'pro-guide'"
        [class.text-gray-400]="activeFramework() !== 'pro-guide'"
        [class.border-transparent]="activeFramework() !== 'pro-guide'">
        PRO GUIDE
      </button>
    </div>

    @if(activeFramework() === 'pro-guide') {
      <app-pro-guide></app-pro-guide>
    } @else {
      <!-- Input Section -->
      <div class="mb-8 p-6 bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg">
        
        <div class="mb-6 flex justify-center bg-gray-900/60 rounded-lg p-1 border border-gray-700 w-fit mx-auto">
          <button (click)="selectOutputType('video')"
                  class="px-6 py-2 text-sm font-medium rounded-md transition-colors duration-200 focus:outline-none"
                  [class.bg-purple-600]="outputType() === 'video'"
                  [class.text-white]="outputType() === 'video'"
                  [class.text-gray-300]="outputType() !== 'video'"
                  [class.hover:bg-gray-700]="outputType() !== 'video'">
              Video Prompt
          </button>
          <button (click)="selectOutputType('image')"
                  class="px-6 py-2 text-sm font-medium rounded-md transition-colors duration-200 focus:outline-none"
                  [class.bg-purple-600]="outputType() === 'image'"
                  [class.text-white]="outputType() === 'image'"
                  [class.text-gray-300]="outputType() !== 'image'"
                  [class.hover:bg-gray-700]="outputType() !== 'image'">
              Image Prompt
          </button>
        </div>

        <label for="subject" class="block text-lg font-medium text-purple-300 mb-3">Enter your subject</label>
        <div class="flex flex-col sm:flex-row gap-4">
          <textarea 
            id="subject"
            [value]="subject()"
            (input)="updateSubject($event)"
            placeholder="e.g., a futuristic city, a cat discovering magic, a luxury watch..."
            class="flex-grow w-full p-4 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition duration-200 h-32 resize-y"
            rows="4"
          ></textarea>
          <button 
            (click)="onGenerate()"
            [disabled]="isLoading() || !subject().trim()"
            class="flex items-center justify-center px-8 py-4 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 disabled:bg-purple-800 disabled:cursor-not-allowed disabled:text-gray-400 transition duration-200 shadow-md transform hover:scale-105 active:scale-100 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-gray-900">
            @if (isLoading()) {
              <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              <span>Generating...</span>
            } @else {
              <span>Generate Prompt</span>
            }
          </button>
        </div>

        <!-- Advanced Controls -->
        <div class="mt-6">
          <label for="advanced-toggle" class="flex items-center cursor-pointer w-fit">
            <div class="relative">
              <input type="checkbox" id="advanced-toggle" class="sr-only" 
                    [checked]="showAdvanced()" 
                    (change)="showAdvanced.set($any($event.target).checked)">
              <div class="block w-14 h-8 rounded-full transition-colors"
                  [class.bg-purple-600]="showAdvanced()"
                  [class.bg-gray-600]="!showAdvanced()"></div>
              <div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform"
                  [class.translate-x-6]="showAdvanced()"></div>
            </div>
            <div class="ml-3 text-gray-300 font-medium select-none">
              Advanced Controls
            </div>
          </label>
        </div>

        @if(showAdvanced()) {
          <div class="mt-4 border-t border-gray-700/50 pt-6 animate-[fadeIn_0.5s_ease-in-out]">
              <h3 class="text-lg font-medium text-purple-300 mb-3">Select Camera Shots (Optional)</h3>
              <div class="max-h-64 overflow-y-auto p-2 pr-4 space-y-2 bg-gray-900/30 rounded-lg border border-gray-700/50">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-3">
                  @for (shot of cameraShots; track shot.name) {
                    <label class="flex items-start space-x-3 cursor-pointer p-2 rounded-md hover:bg-gray-700/50 transition-colors duration-150">
                      <input type="checkbox" 
                            class="form-checkbox flex-shrink-0 mt-0.5 h-5 w-5 text-purple-500 bg-gray-800 border-gray-600 rounded focus:ring-purple-500 focus:ring-offset-gray-900/30"
                            [checked]="selectedCameraShots().includes(shot.name)"
                            (change)="toggleCameraShot(shot.name, $event)">
                      <div>
                        <span class="font-semibold text-white">{{ shot.name }}</span>
                        <p class="text-xs text-gray-400 leading-snug">{{ shot.description }}</p>
                      </div>
                    </label>
                  }
                </div>
              </div>
          </div>
        }
      </div>

      <!-- Output Section -->
      <div class="w-full space-y-8">
        @if (isLoading()) {
          <div class="text-center p-8">
            <div class="flex justify-center items-center space-x-2">
              <div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse [animation-delay:-0.3s]"></div>
              <div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse [animation-delay:-0.15s]"></div>
              <div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse"></div>
            </div>
            <p class="mt-4 text-gray-400">The AI is crafting your prompt...</p>
          </div>
        }

        @if (error()) {
          <div class="bg-red-900/50 border border-red-700 text-red-300 px-4 py-3 rounded-lg" role="alert">
            <strong class="font-bold">Error: </strong>
            <span class="block sm:inline">{{ error() }}</span>
          </div>
        }

        @if (promptSections().length > 0) {
          <div class="bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg relative">
            <div class="p-6 sm:p-8">
              <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                <h2 class="text-2xl font-bold text-white">
                  @if(activeFramework() === 'cinematic') {
                    Your Cinematic Prompt
                  } @else if (activeFramework() === 'articulated') {
                    Your Articulated Animation Prompt
                  } @else {
                    Your Photoreal CGI Prompt
                  }
                </h2>
                <div class="flex items-center gap-2 sm:gap-4 self-end sm:self-center">
                    <div class="flex items-center bg-gray-900/50 border border-gray-700 rounded-lg p-1 text-sm">
                      <button (click)="outputViewMode.set('text')" 
                              class="px-3 py-1 rounded-md transition-colors duration-200 focus:outline-none"
                              [class.bg-purple-600]="outputViewMode() === 'text'"
                              [class.text-white]="outputViewMode() === 'text'"
                              [class.text-gray-300]="outputViewMode() !== 'text'"
                              [class.hover:bg-gray-700]="outputViewMode() !== 'text'">
                          Text
                      </button>
                      <button (click)="outputViewMode.set('json')" 
                              class="px-3 py-1 rounded-md transition-colors duration-200 focus:outline-none"
                              [class.bg-purple-600]="outputViewMode() === 'json'"
                              [class.text-white]="outputViewMode() === 'json'"
                              [class.text-gray-300]="outputViewMode() !== 'json'"
                              [class.hover:bg-gray-700]="outputViewMode() !== 'json'">
                          JSON
                      </button>
                    </div>
                    <button (click)="copyToClipboard()" 
                      class="px-4 py-2 bg-gray-700 text-gray-300 font-semibold rounded-lg hover:bg-gray-600 transition duration-200 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">
                        {{ copyButtonText() }}
                    </button>
                </div>
              </div>
              
              @if(outputViewMode() === 'text') {
                <div class="space-y-6">
                  @for (section of promptSections(); track section.title) {
                    <div class="border-l-4 pl-4"
                      [class.border-purple-500]="section.title !== 'NEGATIVE PROMPT'"
                      [class.border-red-500]="section.title === 'NEGATIVE PROMPT'">
                      <h3 class="text-lg font-semibold"
                        [class.text-purple-300]="section.title !== 'NEGATIVE PROMPT'"
                        [class.text-red-300]="section.title === 'NEGATIVE PROMPT'">
                        {{ section.title }}
                      </h3>
                      <p class="text-gray-300 whitespace-pre-wrap">{{ section.content }}</p>
                    </div>
                  }
                </div>
              } @else {
                <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto border border-gray-700"><code class="text-sm text-gray-300 whitespace-pre-wrap">{{ jsonPrompt() }}</code></pre>
              }
            </div>
          </div>
        }

        <!-- Instant Generation Workspace -->
        @if (generatedPrompt()) {
          <div class="p-6 bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg space-y-8">
            <h2 class="text-2xl font-bold text-white border-b border-gray-700 pb-4">Instant Generation Workspace</h2>
            
             <!-- Video Generation Section -->
             <div class="space-y-6">
              <h3 class="text-lg font-semibold text-purple-300">Video Generation</h3>
              <div class="flex flex-col sm:flex-row gap-4">
                <button (click)="onGenerateVideo()" [disabled]="isGeneratingVideo()" class="flex-1 px-6 py-3 bg-teal-600 text-white font-semibold rounded-lg hover:bg-teal-700 disabled:bg-teal-800 disabled:cursor-not-allowed transition duration-200">
                   @if (isGeneratingVideo()) {
                    <span>Generating Video...</span>
                  } @else {
                    <span>Generate Video</span>
                  }
                </button>
              </div>

              @if (isGeneratingVideo()) {
                <div class="text-center p-4 bg-gray-900/50 rounded-lg border border-gray-700">
                    <div class="flex justify-center items-center space-x-2">
                        <div class="w-3 h-3 rounded-full bg-teal-400 animate-pulse [animation-delay:-0.3s]"></div>
                        <div class="w-3 h-3 rounded-full bg-teal-400 animate-pulse [animation-delay:-0.15s]"></div>
                        <div class="w-3 h-3 rounded-full bg-teal-400 animate-pulse"></div>
                    </div>
                    <p class="mt-3 text-sm text-gray-400">{{ videoGenerationProgress() || 'Initializing...' }}</p>
                </div>
              }
              @if (videoGenerationError(); as error) {
                <p class="text-red-400">{{ error }}</p>
              }
              @if(generatedVideoUrl(); as url) {
                <div class="p-4 bg-gray-900 rounded-lg border border-gray-700 space-y-4">
                  <video [src]="url" controls autoplay loop muted class="w-full rounded-md"></video>
                  <a [href]="url" download="generated-video.mp4" class="block w-full text-center px-6 py-3 bg-gray-700 text-white font-semibold rounded-lg hover:bg-gray-600 cursor-pointer transition duration-200">
                    Download Video
                  </a>
                </div>
              }
            </div>

            <!-- Image Generation Section -->
            <div class="space-y-6 border-t border-gray-700 pt-8">
              <h3 class="text-lg font-semibold text-purple-300">Image Generation</h3>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6 p-4 bg-gray-900/40 border border-gray-700 rounded-lg">
                <div>
                  <label class="block text-sm font-medium text-gray-400 mb-2">Model</label>
                  <div class="flex bg-gray-900/60 rounded-lg p-1 border border-gray-700 w-full">
                    <button (click)="imageModel.set('ultra')" class="flex-1 px-3 py-2 text-xs sm:text-sm font-medium rounded-md transition-colors duration-200 focus:outline-none"
                      [class.bg-purple-600]="imageModel() === 'ultra'"
                      [class.text-white]="imageModel() === 'ultra'"
                      [class.text-gray-300]="imageModel() !== 'ultra'"
                      [class.hover:bg-gray-700]="imageModel() !== 'ultra'">
                      Imagen 4 Ultra
                    </button>
                    <button (click)="imageModel.set('nano')" class="flex-1 px-3 py-2 text-xs sm:text-sm font-medium rounded-md transition-colors duration-200 focus:outline-none"
                      [class.bg-purple-600]="imageModel() === 'nano'"
                      [class.text-white]="imageModel() === 'nano'"
                      [class.text-gray-300]="imageModel() !== 'nano'"
                      [class.hover:bg-gray-700]="imageModel() !== 'nano'">
                      Nano Banana
                    </button>
                  </div>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-400 mb-2">Aspect Ratio</label>
                  <div class="grid grid-cols-5 gap-1 bg-gray-900/60 rounded-lg p-1 border border-gray-700">
                    @for (ratio of aspectRatios; track ratio) {
                      <button 
                        (click)="imageAspectRatio.set(ratio)"
                        class="px-2 py-2 text-xs sm:text-sm font-medium rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center aspect-square sm:aspect-auto"
                        [class.bg-purple-600]="imageAspectRatio() === ratio"
                        [class.text-white]="imageAspectRatio() === ratio"
                        [class.text-gray-300]="imageAspectRatio() !== ratio"
                        [class.hover:bg-gray-700]="imageAspectRatio() !== ratio">
                        {{ ratio }}
                      </button>
                    }
                  </div>
                </div>
              </div>

              <div class="flex flex-col sm:flex-row gap-4">
                <button (click)="onGenerateImage()" [disabled]="isGeneratingImage()" class="flex-1 px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 disabled:bg-indigo-800 disabled:cursor-not-allowed transition duration-200">
                  Generate Image
                </button>
                <label class="flex-1 px-6 py-3 bg-gray-700 text-white font-semibold rounded-lg hover:bg-gray-600 cursor-pointer text-center transition duration-200">
                  Upload Reference
                  <input type="file" (change)="onFileSelected($event)" accept="image/*" class="hidden">
                </label>
              </div>
              
              @if (isGeneratingImage()) {
                <p class="text-center text-gray-400">Generating image...</p>
              }
              @if (imageGenerationError(); as error) {
                <p class="text-red-400">{{ error }}</p>
              }
              @if(generatedImageUrl(); as url) {
                <div class="p-4 bg-gray-900 rounded-lg border border-gray-700 space-y-4">
                  <img [src]="url" alt="Generated or uploaded image" class="max-w-full h-auto mx-auto rounded-md max-h-96">
                  
                  <!-- Action Buttons -->
                  <div class="flex flex-col sm:flex-row gap-4">
                      <a [href]="url" download="generated-image.png" class="flex-1 flex items-center justify-center px-6 py-3 bg-gray-700 text-white font-semibold rounded-lg hover:bg-gray-600 cursor-pointer transition duration-200">
                          Download Image
                      </a>
                      <button (click)="onUpscaleImage()" [disabled]="isUpscalingImage()" class="flex-1 flex items-center justify-center px-6 py-3 bg-pink-600 text-white font-semibold rounded-lg hover:bg-pink-700 disabled:bg-pink-800 disabled:cursor-not-allowed transition duration-200">
                          @if (isUpscalingImage()) {
                              <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                              </svg>
                              <span>Upscaling...</span>
                          } @else {
                              <span>Upscale Image</span>
                          }
                      </button>
                  </div>
                  @if (upscaleImageError(); as error) {
                      <p class="text-red-400 text-center text-sm">{{ error }}</p>
                  }
                </div>
              }
            </div>
          </div>
        }
      </div>
    }
    
  </div>
</main>