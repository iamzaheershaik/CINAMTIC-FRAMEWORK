<main class="h-full overflow-y-auto text-gray-100 flex flex-col p-4 sm:p-8 font-sans">
  <div class="w-full max-w-7xl mx-auto flex flex-col md:flex-row gap-x-8 lg:gap-x-12">
    
    <!-- Vertical Framework Navigation -->
    <nav class="flex flex-row md:flex-col md:w-52 flex-shrink-0 md:sticky md:top-8 md:self-start space-y-0 md:space-y-1 space-x-1 md:space-x-0 overflow-x-auto pb-4 md:pb-0 -mx-4 px-4 md:mx-0 md:px-0">
      <button 
        (click)="selectFramework('cinematic')"
        class="flex-shrink-0 md:w-full text-center md:text-left py-2.5 px-4 rounded-lg focus:outline-none font-medium transition-colors duration-200 text-sm sm:text-base whitespace-nowrap"
        [class.bg-purple-600]="activeFramework() === 'cinematic'"
        [class.text-white]="activeFramework() === 'cinematic'"
        [class.text-gray-400]="activeFramework() !== 'cinematic'"
        [class.hover:bg-gray-700/50]="activeFramework() !== 'cinematic'"
        [class.hover:text-gray-200]="activeFramework() !== 'cinematic'">
        CINEMATIC
      </button>
      <button 
        (click)="selectFramework('articulated')"
        class="flex-shrink-0 md:w-full text-center md:text-left py-2.5 px-4 rounded-lg focus:outline-none font-medium transition-colors duration-200 text-sm sm:text-base whitespace-nowrap"
        [class.bg-purple-600]="activeFramework() === 'articulated'"
        [class.text-white]="activeFramework() === 'articulated'"
        [class.text-gray-400]="activeFramework() !== 'articulated'"
        [class.hover:bg-gray-700/50]="activeFramework() !== 'articulated'"
        [class.hover:text-gray-200]="activeFramework() !== 'articulated'">
        ARTICULATED
      </button>
      <button 
        (click)="selectFramework('photoreal')"
        class="flex-shrink-0 md:w-full text-center md:text-left py-2.5 px-4 rounded-lg focus:outline-none font-medium transition-colors duration-200 text-sm sm:text-base whitespace-nowrap"
        [class.bg-purple-600]="activeFramework() === 'photoreal'"
        [class.text-white]="activeFramework() === 'photoreal'"
        [class.text-gray-400]="activeFramework() !== 'photoreal'"
        [class.hover:bg-gray-700/50]="activeFramework() !== 'photoreal'"
        [class.hover:text-gray-200]="activeFramework() !== 'photoreal'">
        PHOTOREAL
      </button>
      <button 
        (click)="selectFramework('action')"
        class="flex-shrink-0 md:w-full text-center md:text-left py-2.5 px-4 rounded-lg focus:outline-none font-medium transition-colors duration-200 text-sm sm:text-base whitespace-nowrap"
        [class.bg-purple-600]="activeFramework() === 'action'"
        [class.text-white]="activeFramework() === 'action'"
        [class.text-gray-400]="activeFramework() !== 'action'"
        [class.hover:bg-gray-700/50]="activeFramework() !== 'action'"
        [class.hover:text-gray-200]="activeFramework() !== 'action'">
        ACTION
      </button>
      <button 
        (click)="selectFramework('motion')"
        class="flex-shrink-0 md:w-full text-center md:text-left py-2.5 px-4 rounded-lg focus:outline-none font-medium transition-colors duration-200 text-sm sm:text-base whitespace-nowrap"
        [class.bg-purple-600]="activeFramework() === 'motion'"
        [class.text-white]="activeFramework() === 'motion'"
        [class.text-gray-400]="activeFramework() !== 'motion'"
        [class.hover:bg-gray-700/50]="activeFramework() !== 'motion'"
        [class.hover:text-gray-200]="activeFramework() !== 'motion'">
        MOTION
      </button>
      <button 
        (click)="selectFramework('transformation')"
        class="flex-shrink-0 md:w-full text-center md:text-left py-2.5 px-4 rounded-lg focus:outline-none font-medium transition-colors duration-200 text-sm sm:text-base whitespace-nowrap"
        [class.bg-purple-600]="activeFramework() === 'transformation'"
        [class.text-white]="activeFramework() === 'transformation'"
        [class.text-gray-400]="activeFramework() !== 'transformation'"
        [class.hover:bg-gray-700/50]="activeFramework() !== 'transformation'"
        [class.hover:text-gray-200]="activeFramework() !== 'transformation'">
        TRANSFORMATION
      </button>
      <button 
        (click)="selectFramework('logo-reveal')"
        class="flex-shrink-0 md:w-full text-center md:text-left py-2.5 px-4 rounded-lg focus:outline-none font-medium transition-colors duration-200 text-sm sm:text-base whitespace-nowrap"
        [class.bg-purple-600]="activeFramework() === 'logo-reveal'"
        [class.text-white]="activeFramework() === 'logo-reveal'"
        [class.text-gray-400]="activeFramework() !== 'logo-reveal'"
        [class.hover:bg-gray-700/50]="activeFramework() !== 'logo-reveal'"
        [class.hover:text-gray-200]="activeFramework() !== 'logo-reveal'">
        LOGO REVEAL
      </button>
      <button 
        (click)="selectFramework('storyboard')"
        class="flex-shrink-0 md:w-full text-center md:text-left py-2.5 px-4 rounded-lg focus:outline-none font-medium transition-colors duration-200 text-sm sm:text-base whitespace-nowrap"
        [class.bg-purple-600]="activeFramework() === 'storyboard'"
        [class.text-white]="activeFramework() === 'storyboard'"
        [class.text-gray-400]="activeFramework() !== 'storyboard'"
        [class.hover:bg-gray-700/50]="activeFramework() !== 'storyboard'"
        [class.hover:text-gray-200]="activeFramework() !== 'storyboard'">
        STORYBOARD
      </button>
      <button 
        (click)="selectFramework('character')"
        class="flex-shrink-0 md:w-full text-center md:text-left py-2.5 px-4 rounded-lg focus:outline-none font-medium transition-colors duration-200 text-sm sm:text-base whitespace-nowrap"
        [class.bg-purple-600]="activeFramework() === 'character'"
        [class.text-white]="activeFramework() === 'character'"
        [class.text-gray-400]="activeFramework() !== 'character'"
        [class.hover:bg-gray-700/50]="activeFramework() !== 'character'"
        [class.hover:text-gray-200]="activeFramework() !== 'character'">
        CHARACTER
      </button>
      <button 
        (click)="selectFramework('pro-guide')"
        class="flex-shrink-0 md:w-full text-center md:text-left py-2.5 px-4 rounded-lg focus:outline-none font-medium transition-colors duration-200 text-sm sm:text-base whitespace-nowrap"
        [class.bg-purple-600]="activeFramework() === 'pro-guide'"
        [class.text-white]="activeFramework() === 'pro-guide'"
        [class.text-gray-400]="activeFramework() !== 'pro-guide'"
        [class.hover:bg-gray-700/50]="activeFramework() !== 'pro-guide'"
        [class.hover:text-gray-200]="activeFramework() !== 'pro-guide'">
        PRO GUIDE
      </button>
      <button 
        (click)="selectFramework('myth-prompt')"
        class="flex-shrink-0 md:w-full text-center md:text-left py-2.5 px-4 rounded-lg focus:outline-none font-medium transition-colors duration-200 text-sm sm:text-base whitespace-nowrap"
        [class.bg-yellow-600]="activeFramework() === 'myth-prompt'"
        [class.text-gray-900]="activeFramework() === 'myth-prompt'"
        [class.text-gray-400]="activeFramework() !== 'myth-prompt'"
        [class.hover:bg-gray-700/50]="activeFramework() !== 'myth-prompt'"
        [class.hover:text-gray-200]="activeFramework() !== 'myth-prompt'">
        MYTHPROMPT STUDIO
      </button>
    </nav>

    <!-- Main Content Area -->
    <div class="flex-1 min-w-0">
      @if (activeFramework() !== 'pro-guide' && activeFramework() !== 'myth-prompt' && activeFramework() !== 'transformation' && activeFramework() !== 'storyboard' && activeFramework() !== 'character' && activeFramework() !== 'motion' && activeFramework() !== 'action' && activeFramework() !== 'logo-reveal') {
        <!-- Header for Cinematic, Articulated, Photoreal -->
        <header class="text-center mb-8">
          <h1 class="text-4xl sm:text-5xl font-bold text-white mb-2">
            AI Prompt Generator
          </h1>
          @if (activeFramework() === 'cinematic') {
            <p class="text-lg text-gray-400">
              Transform simple ideas into detailed video prompts with the CINEMATIC framework.
            </p>
          } @else if (activeFramework() === 'articulated') {
            <p class="text-lg text-gray-400">
              Craft revolutionary AI animation prompts with the ARTICULATED framework.
            </p>
          } @else {
            <p class="text-lg text-gray-400">
              Produce stunning CGI product commercials with the PHOTOREAL framework.
            </p>
          }
        </header>
      }

      @if(activeFramework() === 'pro-guide') {
        <app-pro-guide></app-pro-guide>
      } @else if (activeFramework() === 'myth-prompt') {
        <app-myth-prompt></app-myth-prompt>
      } @else if (activeFramework() === 'logo-reveal') {
        <!-- Logo Reveal UI -->
        <header class="text-center mb-8">
          <h1 class="text-4xl sm:text-5xl font-bold text-white mb-2">
            Cinematic Logo Reveal Generator
          </h1>
          <p class="text-lg text-gray-400">
            Upload your logo to generate a professional, After Effects-style animation prompt.
          </p>
        </header>
        <div class="w-full space-y-8">
          <div class="p-6 bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg">
            <div class="flex flex-col md:flex-row gap-6 items-center">
              <!-- Uploader -->
              <div class="flex-1 w-full">
                <label for="logo-upload" class="flex flex-col items-center justify-center w-full h-48 border-2 border-gray-600 border-dashed rounded-lg cursor-pointer bg-gray-800 hover:bg-gray-700/50 transition-colors">
                  @if (uploadedLogoPreview()) {
                    <img [src]="uploadedLogoPreview()" alt="Logo Preview" class="max-h-44 object-contain p-2">
                  } @else {
                    <div class="flex flex-col items-center justify-center pt-5 pb-6">
                      <svg class="w-8 h-8 mb-4 text-gray-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                      </svg>
                      <p class="mb-2 text-sm text-gray-400"><span class="font-semibold">Click to upload</span> or drag and drop</p>
                      <p class="text-xs text-gray-500">PNG, JPG, WEBP (MAX. 5MB)</p>
                    </div>
                  }
                  <input id="logo-upload" type="file" class="hidden" (change)="onLogoFileSelected($event)" accept="image/png, image/jpeg, image/webp">
                </label>
              </div>
              <!-- Generate Button -->
              <div class="flex-shrink-0">
                <button 
                  (click)="onGenerateLogoReveal()"
                  [disabled]="isLoading() || !uploadedLogo()"
                  class="flex items-center justify-center w-full md:w-auto px-8 py-4 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 disabled:bg-purple-800 disabled:cursor-not-allowed disabled:text-gray-400 transition duration-200 shadow-md transform hover:scale-105 active:scale-100 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-gray-900 h-48">
                  @if (isLoading()) {
                    <div class="text-center">
                      <svg class="animate-spin mx-auto h-8 w-8 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                      </svg>
                      <span class="mt-2 block">Generating...</span>
                    </div>
                  } @else {
                    <span class="text-lg">Generate Reveal</span>
                  }
                </button>
              </div>
            </div>
          </div>
          
          <!-- Output Section -->
          @if (isLoading()) {
            <div class="text-center p-8">
              <div class="flex justify-center items-center space-x-2">
                <div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse [animation-delay:-0.3s]"></div>
                <div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse [animation-delay:-0.15s]"></div>
                <div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse"></div>
              </div>
              <p class="mt-4 text-gray-400">The AI is analyzing your logo and crafting a prompt...</p>
            </div>
          }

          @if (error()) {
            <div class="bg-red-900/50 border border-red-700 text-red-300 px-4 py-3 rounded-lg" role="alert">
              <strong class="font-bold">Error: </strong>
              <span class="block sm:inline">{{ error() }}</span>
            </div>
          }

          @if (logoRevealJson()) {
            <div class="bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg relative">
              <div class="p-6 sm:p-8">
                <div class="flex justify-between items-center mb-6">
                  <h2 class="text-2xl font-bold text-white">Your Logo Reveal Prompt</h2>
                  <button (click)="copyToClipboard()" 
                    class="px-4 py-2 bg-gray-700 text-gray-300 font-semibold rounded-lg hover:bg-gray-600 transition duration-200 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">
                      {{ copyButtonText() }}
                  </button>
                </div>
                <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto border border-gray-700"><code class="text-sm text-gray-300 whitespace-pre-wrap">{{ logoRevealJson() }}</code></pre>
              </div>
            </div>
          }
        </div>
      } @else if (activeFramework() === 'transformation') {
          <!-- Header -->
          <header class="text-center mb-8">
            <h1 class="text-4xl sm:text-5xl font-bold text-white mb-2">
              AI Transformation Prompt Generator
            </h1>
            <p class="text-lg text-gray-400">
              Craft detailed video prompts for source-to-target transformations.
            </p>
          </header>

          <!-- Input Section -->
          <div class="mb-8 p-6 bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg space-y-6">
            <div class="flex flex-col md:flex-row gap-6">
              <!-- Source Subject -->
              <div class="flex-1">
                <label for="source-subject" class="block text-lg font-medium text-purple-300 mb-3">Source Subject</label>
                <textarea 
                  id="source-subject"
                  [value]="sourceSubject()"
                  (input)="updateSourceSubject($event)"
                  placeholder="e.g., A man in a business suit..."
                  class="w-full p-4 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition duration-200 overflow-hidden"
                  rows="2"
                ></textarea>
              </div>
              <!-- Target Subject -->
              <div class="flex-1">
                <label for="target-subject" class="block text-lg font-medium text-purple-300 mb-3">Target Subject</label>
                <textarea 
                  id="target-subject"
                  [value]="targetSubject()"
                  (input)="updateTargetSubject($event)"
                  placeholder="e.g., ...transforms into a powerful cyborg warrior."
                  class="w-full p-4 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition duration-200 overflow-hidden"
                  rows="2"
                ></textarea>
              </div>
            </div>
            <div class="text-center">
              <button 
                (click)="onGenerate()"
                [disabled]="isLoading() || !sourceSubject().trim() || !targetSubject().trim()"
                class="flex items-center mx-auto justify-center px-8 py-4 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 disabled:bg-purple-800 disabled:cursor-not-allowed disabled:text-gray-400 transition duration-200 shadow-md transform hover:scale-105 active:scale-100 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-gray-900">
                @if (isLoading()) {
                  <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                  <span>Generating...</span>
                } @else {
                  <span>Generate Transformation</span>
                }
              </button>
            </div>
          </div>

          <!-- Output Section -->
          <div class="w-full space-y-8">
            @if (isLoading()) {
              <div class="text-center p-8">
                <div class="flex justify-center items-center space-x-2">
                  <div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse [animation-delay:-0.3s]"></div>
                  <div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse [animation-delay:-0.15s]"></div>
                  <div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse"></div>
                </div>
                <p class="mt-4 text-gray-400">The AI is crafting your transformation prompt...</p>
              </div>
            }

            @if (error()) {
              <div class="bg-red-900/50 border border-red-700 text-red-300 px-4 py-3 rounded-lg" role="alert">
                <strong class="font-bold">Error: </strong>
                <span class="block sm:inline">{{ error() }}</span>
              </div>
            }

            @if (promptSections().length > 0) {
              <div class="bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg relative">
                <div class="p-6 sm:p-8">
                  <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-white">{{ promptSections()[0].title }}</h2>
                    <button (click)="copyToClipboard()" 
                      class="px-4 py-2 bg-gray-700 text-gray-300 font-semibold rounded-lg hover:bg-gray-600 transition duration-200 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">
                        {{ copyButtonText() }}
                    </button>
                  </div>
                  <div class="bg-gray-900 p-4 rounded-lg border border-gray-700">
                    <p class="text-gray-300 whitespace-pre-wrap">{{ promptSections()[0].content }}</p>
                  </div>
                </div>
              </div>
            }
          </div>
      } @else if (activeFramework() === 'storyboard') {
        <!-- Storyboard UI -->
        <header class="text-center mb-8">
          <h1 class="text-4xl sm:text-5xl font-bold text-white mb-2">Storyboard AI Generator</h1>
          <p class="text-lg text-gray-400">Describe a scene, and the AI will generate a cinematic shot sequence.</p>
        </header>
        <div class="w-full space-y-8">
          <div class="p-6 bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg space-y-4">
            <label for="storyboard-scene" class="block text-lg font-medium text-purple-300 mb-3">Scene Description</label>
            <textarea id="storyboard-scene"
              [value]="storyboardScene()"
              (input)="updateStoryboardScene($event)"
              placeholder="e.g., A detective finds a mysterious clue in a rain-soaked alley at night."
              class="w-full p-4 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition duration-200 overflow-hidden"
              rows="2"
            ></textarea>
            <div class="text-center pt-2">
              <button (click)="onGenerateStoryboard()"
                [disabled]="isLoading() || !storyboardScene().trim()"
                class="flex items-center mx-auto justify-center px-8 py-4 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 disabled:bg-purple-800 disabled:cursor-not-allowed disabled:text-gray-400 transition duration-200 shadow-md transform hover:scale-105 active:scale-100 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-gray-900">
                @if (isLoading()) {
                  <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                  <span>Generating Storyboard...</span>
                } @else {
                  <span>Generate Storyboard</span>
                }
              </button>
            </div>
          </div>
          
          @if (isLoading()) {
            <div class="text-center p-8"><div class="flex justify-center items-center space-x-2"><div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse [animation-delay:-0.3s]"></div><div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse [animation-delay:-0.15s]"></div><div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse"></div></div><p class="mt-4 text-gray-400">The AI is crafting your storyboard...</p></div>
          }
          @if (error()) {
            <div class="bg-red-900/50 border border-red-700 text-red-300 px-4 py-3 rounded-lg" role="alert"><strong class="font-bold">Error: </strong><span class="block sm:inline">{{ error() }}</span></div>
          }
          @if (storyboardJson()) {
            <div class="bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg relative"><div class="p-6 sm:p-8"><div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-bold text-white">Your AI-Generated Storyboard</h2><button (click)="copyToClipboard()" class="px-4 py-2 bg-gray-700 text-gray-300 font-semibold rounded-lg hover:bg-gray-600 transition duration-200 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">{{ copyButtonText() }}</button></div><pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto border border-gray-700"><code class="text-sm text-gray-300 whitespace-pre-wrap">{{ storyboardJson() }}</code></pre></div></div>
          }
        </div>
      } @else if (activeFramework() === 'character') {
        <!-- Character UI -->
        <header class="text-center mb-8">
          <h1 class="text-4xl sm:text-5xl font-bold text-white mb-2">Character Consistency Packet</h1>
          <p class="text-lg text-gray-400">Generate a detailed character sheet to maintain consistency across multiple prompts.</p>
        </header>
        <div class="w-full space-y-8">
          <div class="p-6 bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg space-y-4">
            <label for="character-description" class="block text-lg font-medium text-purple-300 mb-3">Character Description</label>
            <textarea id="character-description"
              [value]="characterDescription()"
              (input)="updateCharacterDescription($event)"
              placeholder="e.g., A grizzled space marine with a cybernetic arm and a sarcastic attitude."
              class="w-full p-4 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition duration-200 overflow-hidden"
              rows="2"
            ></textarea>
            <div class="text-center pt-2">
              <button (click)="onGenerateCharacterPacket()"
                [disabled]="isLoading() || !characterDescription().trim()"
                class="flex items-center mx-auto justify-center px-8 py-4 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 disabled:bg-purple-800 disabled:cursor-not-allowed disabled:text-gray-400 transition duration-200 shadow-md transform hover:scale-105 active:scale-100 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-gray-900">
                @if (isLoading()) {
                  <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                  <span>Generating Packet...</span>
                } @else {
                  <span>Generate Character Packet</span>
                }
              </button>
            </div>
          </div>
          
          @if (isLoading()) {
            <div class="text-center p-8"><div class="flex justify-center items-center space-x-2"><div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse [animation-delay:-0.3s]"></div><div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse [animation-delay:-0.15s]"></div><div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse"></div></div><p class="mt-4 text-gray-400">The AI is creating your character packet...</p></div>
          }
          @if (error()) {
            <div class="bg-red-900/50 border border-red-700 text-red-300 px-4 py-3 rounded-lg" role="alert"><strong class="font-bold">Error: </strong><span class="block sm:inline">{{ error() }}</span></div>
          }
          @if (characterPacketJson()) {
            <div class="bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg relative"><div class="p-6 sm:p-8"><div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-bold text-white">Your Character Consistency Packet</h2><button (click)="copyToClipboard()" class="px-4 py-2 bg-gray-700 text-gray-300 font-semibold rounded-lg hover:bg-gray-600 transition duration-200 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">{{ copyButtonText() }}</button></div><pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto border border-gray-700"><code class="text-sm text-gray-300 whitespace-pre-wrap">{{ characterPacketJson() }}</code></pre></div></div>
          }
        </div>
      } @else if (activeFramework() === 'action') {
        <!-- Action UI -->
        <header class="text-center mb-8">
          <h1 class="text-4xl sm:text-5xl font-bold text-white mb-2">Hollywood Action Scene Generator</h1>
          <p class="text-lg text-gray-400">Generate a cinematic, structured action prompt based on foundational Hollywood principles.</p>
        </header>
        <div class="w-full space-y-8">
          <div class="p-6 bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg">
            <div class="space-y-8">
              <section>
                <h3 class="text-xl font-bold text-purple-300 border-b border-purple-800/50 pb-2 mb-4">Narrative Core (Mandatory)</h3>
                <div class="grid md:grid-cols-3 gap-6">
                  <div><label class="block text-sm font-medium text-gray-300 mb-2">Goal</label><textarea [value]="actionNarrativeCoreGoal()" (input)="updateActionNarrativeCoreGoal($event)" rows="2" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-sm text-white placeholder-gray-500 focus:ring-1 focus:ring-purple-500 overflow-hidden"></textarea></div>
                  <div><label class="block text-sm font-medium text-gray-300 mb-2">Stakes</label><textarea [value]="actionNarrativeCoreStakes()" (input)="updateActionNarrativeCoreStakes($event)" rows="2" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-sm text-white placeholder-gray-500 focus:ring-1 focus:ring-purple-500 overflow-hidden"></textarea></div>
                  <div><label class="block text-sm font-medium text-gray-300 mb-2">Consequence</label><textarea [value]="actionNarrativeCoreConsequence()" (input)="updateActionNarrativeCoreConsequence($event)" rows="2" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-sm text-white placeholder-gray-500 focus:ring-1 focus:ring-purple-500 overflow-hidden"></textarea></div>
                </div>
              </section>
              <section>
                <h3 class="text-xl font-bold text-purple-300 border-b border-purple-800/50 pb-2 mb-4">Character Dynamics (Mandatory)</h3>
                <div class="grid md:grid-cols-2 gap-8">
                  <div class="space-y-4 p-4 bg-gray-900/40 rounded-lg border border-gray-700/60"><h4 class="font-semibold text-white">Protagonist</h4>
                    <div><label class="block text-sm font-medium text-gray-400 mb-1">Name</label><input type="text" [value]="actionProtagonistName()" (input)="actionProtagonistName.set($any($event.target).value)" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-sm"></div>
                    <div><label class="block text-sm font-medium text-gray-400 mb-1">Trait</label><input type="text" [value]="actionProtagonistTrait()" (input)="actionProtagonistTrait.set($any($event.target).value)" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-sm"></div>
                    <div><label class="block text-sm font-medium text-gray-400 mb-1">Fighting Style</label><input type="text" [value]="actionProtagonistFightStyle()" (input)="actionProtagonistFightStyle.set($any($event.target).value)" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-sm"></div>
                  </div>
                  <div class="space-y-4 p-4 bg-gray-900/40 rounded-lg border border-gray-700/60"><h4 class="font-semibold text-white">Antagonist</h4>
                    <div><label class="block text-sm font-medium text-gray-400 mb-1">Name</label><input type="text" [value]="actionAntagonistName()" (input)="actionAntagonistName.set($any($event.target).value)" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-sm"></div>
                    <div><label class="block text-sm font-medium text-gray-400 mb-1">Trait</label><input type="text" [value]="actionAntagonistTrait()" (input)="actionAntagonistTrait.set($any($event.target).value)" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-sm"></div>
                    <div><label class="block text-sm font-medium text-gray-400 mb-1">Fighting Style</label><input type="text" [value]="actionAntagonistFightStyle()" (input)="actionAntagonistFightStyle.set($any($event.target).value)" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-sm"></div>
                  </div>
                </div>
                <div class="mt-4"><label class="block text-sm font-medium text-gray-300 mb-2">Relationship</label><textarea [value]="actionRelationship()" (input)="updateActionRelationship($event)" rows="1" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-sm text-white placeholder-gray-500 focus:ring-1 focus:ring-purple-500 overflow-hidden"></textarea></div>
              </section>
               <section>
                <h3 class="text-xl font-bold text-purple-300 border-b border-purple-800/50 pb-2 mb-4">Environmental Context (Mandatory)</h3>
                <div class="grid md:grid-cols-3 gap-6">
                  <div><label class="block text-sm font-medium text-gray-300 mb-2">Setting</label><input type="text" [value]="actionSetting()" (input)="actionSetting.set($any($event.target).value)" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-sm"></div>
                  <div><label class="block text-sm font-medium text-gray-300 mb-2">Atmosphere</label><input type="text" [value]="actionAtmosphere()" (input)="actionAtmosphere.set($any($event.target).value)" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-sm"></div>
                  <div><label class="block text-sm font-medium text-gray-300 mb-2">Key Objects (comma-separated)</label><input type="text" [value]="actionKeyObjects()" (input)="actionKeyObjects.set($any($event.target).value)" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-sm"></div>
                </div>
              </section>
            </div>
            <div class="mt-8 text-center"><button (click)="showActionOptional.set(!showActionOptional())" class="px-4 py-2 text-sm font-semibold text-teal-200 bg-teal-900/50 rounded-lg hover:bg-teal-900/80 transition flex items-center gap-2 mx-auto"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 transition-transform" [class.rotate-180]="showActionOptional()"><path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" /></svg> {{ showActionOptional() ? 'Hide' : 'Show' }} Optional Parameters</button></div>
            @if (showActionOptional()) {
              <div class="border-t border-gray-700/50 mt-8 pt-8 space-y-8 animate-[fadeIn_0.5s_ease-in-out]">
                <section><h3 class="text-xl font-bold text-teal-300 border-b border-teal-800/50 pb-2 mb-4">Visual Style</h3><div class="grid md:grid-cols-3 gap-6">
                  <div><label class="block text-sm font-medium text-gray-400 mb-1">Camera Angle</label><input type="text" [value]="actionCameraAngle()" (input)="actionCameraAngle.set($any($event.target).value)" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-sm"></div>
                  <div><label class="block text-sm font-medium text-gray-400 mb-1">Lens Choice</label><input type="text" [value]="actionLensChoice()" (input)="actionLensChoice.set($any($event.target).value)" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-sm"></div>
                  <div><label class="block text-sm font-medium text-gray-400 mb-1">Lighting</label><input type="text" [value]="actionLighting()" (input)="actionLighting.set($any($event.target).value)" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-sm"></div>
                </div></section>
                <section><h3 class="text-xl font-bold text-teal-300 border-b border-teal-800/50 pb-2 mb-4">Pacing & Rhythm</h3><div class="grid md:grid-cols-2 gap-6">
                  <div><label class="block text-sm font-medium text-gray-400 mb-1">Opening Rhythm</label><input type="text" [value]="actionOpeningRhythm()" (input)="actionOpeningRhythm.set($any($event.target).value)" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-sm"></div>
                  <div><label class="block text-sm font-medium text-gray-400 mb-1">Climax Rhythm</label><input type="text" [value]="actionClimaxRhythm()" (input)="actionClimaxRhythm.set($any($event.target).value)" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-sm"></div>
                  <div><label class="block text-sm font-medium text-gray-400 mb-1">Transitions (comma-separated)</label><input type="text" [value]="actionTransitions()" (input)="actionTransitions.set($any($event.target).value)" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-sm"></div>
                  <div><label class="block text-sm font-medium text-gray-400 mb-1">Special Effects (comma-separated)</label><input type="text" [value]="actionSpecialEffects()" (input)="actionSpecialEffects.set($any($event.target).value)" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-sm"></div>
                </div></section>
                <section><h3 class="text-xl font-bold text-teal-300 border-b border-teal-800/50 pb-2 mb-4">Sound Design</h3><div class="grid md:grid-cols-3 gap-6">
                  <div><label class="block text-sm font-medium text-gray-400 mb-1">Ambient Sounds</label><input type="text" [value]="actionAmbientSounds()" (input)="actionAmbientSounds.set($any($event.target).value)" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-sm"></div>
                  <div><label class="block text-sm font-medium text-gray-400 mb-1">Impact Sounds</label><input type="text" [value]="actionImpactSounds()" (input)="actionImpactSounds.set($any($event.target).value)" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-sm"></div>
                  <div><label class="block text-sm font-medium text-gray-400 mb-1">Sound Design Notes</label><input type="text" [value]="actionSoundDesignNotes()" (input)="actionSoundDesignNotes.set($any($event.target).value)" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-sm"></div>
                </div></section>
                <section><h3 class="text-xl font-bold text-teal-300 border-b border-teal-800/50 pb-2 mb-4">Technical Notes</h3><div>
                  <textarea [value]="actionTechnicalNotes()" (input)="updateActionTechnicalNotes($event)" rows="2" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-sm text-white placeholder-gray-500 focus:ring-1 focus:ring-teal-500 overflow-hidden"></textarea>
                </div></section>
              </div>
            }
            <div class="text-center pt-8 border-t border-gray-700/50 mt-8">
              <button (click)="onGenerateActionPrompt()"
                [disabled]="isLoading() || !actionNarrativeCoreGoal().trim() || !actionNarrativeCoreStakes().trim() || !actionNarrativeCoreConsequence().trim() || !actionProtagonistName().trim() || !actionProtagonistTrait().trim() || !actionProtagonistFightStyle().trim() || !actionAntagonistName().trim() || !actionAntagonistTrait().trim() || !actionAntagonistFightStyle().trim() || !actionRelationship().trim() || !actionSetting().trim() || !actionAtmosphere().trim()"
                class="flex items-center mx-auto justify-center px-8 py-4 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 disabled:bg-purple-800 disabled:cursor-not-allowed disabled:text-gray-400 transition duration-200 shadow-md transform hover:scale-105 active:scale-100 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-gray-900">
                @if (isLoading()) {
                  <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                  <span>Generating Prompt...</span>
                } @else {
                  <span>Generate Action Prompt</span>
                }
              </button>
            </div>
          </div>
          @if (isLoading()) {
            <div class="text-center p-8"><div class="flex justify-center items-center space-x-2"><div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse [animation-delay:-0.3s]"></div><div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse [animation-delay:-0.15s]"></div><div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse"></div></div><p class="mt-4 text-gray-400">The AI is crafting your action prompt...</p></div>
          }
          @if (error()) {
            <div class="bg-red-900/50 border border-red-700 text-red-300 px-4 py-3 rounded-lg" role="alert"><strong class="font-bold">Error: </strong><span class="block sm:inline">{{ error() }}</span></div>
          }
          @if (actionPromptJson()) {
            <div class="bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg relative"><div class="p-6 sm:p-8"><div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-bold text-white">Your Generated Action Prompt</h2><button (click)="copyToClipboard()" class="px-4 py-2 bg-gray-700 text-gray-300 font-semibold rounded-lg hover:bg-gray-600 transition duration-200 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">{{ copyButtonText() }}</button></div><pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto border border-gray-700"><code class="text-sm text-gray-300 whitespace-pre-wrap">{{ actionPromptJson() }}</code></pre></div></div>
          }
        </div>
      } @else if (activeFramework() === 'motion') {
        <!-- Motion UI -->
        <header class="text-center mb-8">
          <h1 class="text-4xl sm:text-5xl font-bold text-white mb-2">AI Motion Prompt Generator</h1>
          <p class="text-lg text-gray-400">Design complex video motion effects with a structured, professional framework.</p>
        </header>
        <div class="w-full space-y-8">
          <div class="p-6 bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg space-y-6">
            <div>
              <label for="motion-scene" class="block text-lg font-medium text-purple-300 mb-3">Scene Description</label>
              <textarea id="motion-scene"
                [value]="motionSceneDescription()"
                (input)="updateMotionSceneDescription($event)"
                placeholder="e.g., a golden retriever running through a sunlit meadow with wildflowers"
                class="w-full p-4 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition duration-200 overflow-hidden"
                rows="2"
              ></textarea>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="motion-category" class="block text-sm font-medium text-gray-300 mb-2">Motion Category</label>
                    <select id="motion-category"
                        class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5"
                        (change)="selectedMotionCategory.set($any($event.target).value); selectedMotionType.set('')">
                        <option value="">Select a category...</option>
                        @for (cat of motionTaxonomy; track cat.category) {
                            <option [value]="cat.category">{{ cat.category }}</option>
                        }
                    </select>
                </div>
                <div>
                    <label for="motion-type" class="block text-sm font-medium text-gray-300 mb-2">Motion Type</label>
                    <select id="motion-type"
                        class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5"
                        [disabled]="!selectedMotionCategory()"
                        (change)="selectedMotionType.set($any($event.target).value)">
                        <option value="">Select a motion...</option>
                        @for (motion of availableMotions(); track motion.name) {
                            <option [value]="motion.name">{{ motion.name }}</option>
                        }
                    </select>
                </div>
            </div>
            
            <div class="border-t border-gray-700/50 pt-4">
                <h3 class="text-lg font-medium text-teal-300 mb-4">Optional Parameters</h3>
                <div class="grid grid-cols-2 lg:grid-cols-3 gap-4">
                    <div>
                        <label for="motion-duration" class="block text-sm font-medium text-gray-400 mb-1">Duration</label>
                        <select id="motion-duration" [value]="motionDuration()" (change)="motionDuration.set($any($event.target).value)" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-sm text-white focus:ring-1 focus:ring-teal-500">
                            <option>3-second</option><option>5-second</option><option>10-second</option><option>30-second</option>
                        </select>
                    </div>
                    <div>
                        <label for="motion-angle" class="block text-sm font-medium text-gray-400 mb-1">Camera Angle</label>
                        <select id="motion-angle" [value]="motionCameraAngle()" (change)="motionCameraAngle.set($any($event.target).value)" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-sm text-white focus:ring-1 focus:ring-teal-500">
                             <option>aerial</option><option>eye-level</option><option>low-angle</option><option>high-angle</option><option>POV</option><option>wide-angle</option>
                        </select>
                    </div>
                     <div>
                        <label for="motion-intensity" class="block text-sm font-medium text-gray-400 mb-1">Intensity</label>
                        <select id="motion-intensity" [value]="motionIntensity()" (change)="motionIntensity.set($any($event.target).value)" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-sm text-white focus:ring-1 focus:ring-teal-500">
                            <option>subtle</option><option>moderate</option><option>dramatic</option><option>extreme</option>
                        </select>
                    </div>
                    <div>
                        <label for="motion-lighting" class="block text-sm font-medium text-gray-400 mb-1">Lighting</label>
                        <select id="motion-lighting" [value]="motionLighting()" (change)="motionLighting.set($any($event.target).value)" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-sm text-white focus:ring-1 focus:ring-teal-500">
                            <option>golden hour</option><option>natural lighting</option><option>studio lighting</option><option>dramatic shadows</option><option>neon lights</option><option>cinematic</option>
                        </select>
                    </div>
                    <div>
                        <label for="motion-quality" class="block text-sm font-medium text-gray-400 mb-1">Quality</label>
                        <select id="motion-quality" [value]="motionQuality()" (change)="motionQuality.set($any($event.target).value)" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-sm text-white focus:ring-1 focus:ring-teal-500">
                            <option>4K, cinematic</option><option>HD, realistic</option><option>8K ultra-detailed</option><option>stylized animation</option>
                        </select>
                    </div>
                    <div>
                        <label for="motion-fps" class="block text-sm font-medium text-gray-400 mb-1">Frame Rate</label>
                        <select id="motion-fps" [value]="motionFrameRate()" (change)="motionFrameRate.set(+$any($event.target).value)" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-sm text-white focus:ring-1 focus:ring-teal-500">
                            <option>24</option><option>30</option><option>60</option><option>120</option>
                        </select>
                    </div>
                </div>
            </div>

            @if (selectedMotionType() === 'speed_ramp') {
              <div class="border-t border-gray-700/50 pt-4 animate-[fadeIn_0.5s_ease-in-out]">
                  <h3 class="text-lg font-medium text-teal-300 mb-4">Speed Ramp Parameters</h3>
                  <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                      <div><label class="block text-sm font-medium text-gray-400 mb-1">Start Speed</label><input type="text" [value]="motionSpeedRamp().start" (input)="updateMotionSpeedRamp('start', $event)" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-sm"></div>
                      <div><label class="block text-sm font-medium text-gray-400 mb-1">End Speed</label><input type="text" [value]="motionSpeedRamp().end" (input)="updateMotionSpeedRamp('end', $event)" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-sm"></div>
                      <div><label class="block text-sm font-medium text-gray-400 mb-1">Ramp Point</label><input type="text" [value]="motionSpeedRamp().point" (input)="updateMotionSpeedRamp('point', $event)" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-sm"></div>
                      <div><label class="block text-sm font-medium text-gray-400 mb-1">Curve</label><input type="text" [value]="motionSpeedRamp().curve" (input)="updateMotionSpeedRamp('curve', $event)" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-sm"></div>
                  </div>
              </div>
            }
             @if (selectedMotionType() === 'bullet_time') {
              <div class="border-t border-gray-700/50 pt-4 animate-[fadeIn_0.5s_ease-in-out]">
                  <h3 class="text-lg font-medium text-teal-300 mb-4">Bullet Time Parameters</h3>
                  <div class="grid grid-cols-2 gap-4">
                      <div><label class="block text-sm font-medium text-gray-400 mb-1">Camera Arc</label><input type="text" [value]="motionBulletTime().arc" (input)="updateMotionBulletTime('arc', $event)" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-sm"></div>
                      <div><label class="block text-sm font-medium text-gray-400 mb-1">Freeze Duration</label><input type="text" [value]="motionBulletTime().duration" (input)="updateMotionBulletTime('duration', $event)" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-sm"></div>
                  </div>
              </div>
            }
             @if (selectedMotionType() === 'dolly_zoom') {
              <div class="border-t border-gray-700/50 pt-4 animate-[fadeIn_0.5s_ease-in-out]">
                  <h3 class="text-lg font-medium text-teal-300 mb-4">Dolly Zoom Parameters</h3>
                  <div class="grid grid-cols-2 gap-4">
                      <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">Direction</label>
                        <select [value]="motionDollyZoom().dolly" (change)="updateMotionDollyZoomDirection($event)" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-sm text-white focus:ring-1 focus:ring-teal-500">
                          <option value="in">Dolly In / Zoom Out</option>
                          <option value="out">Dolly Out / Zoom In</option>
                        </select>
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">Intensity</label>
                        <select [value]="motionDollyZoom().intensity" (change)="updateMotionDollyZoomIntensity($event)" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-sm text-white focus:ring-1 focus:ring-teal-500">
                          <option>subtle</option><option>moderate</option><option>dramatic</option>
                        </select>
                      </div>
                  </div>
              </div>
            }
             @if (selectedMotionType() === 'parallax_motion') {
              <div class="border-t border-gray-700/50 pt-4 animate-[fadeIn_0.5s_ease-in-out]">
                  <h3 class="text-lg font-medium text-teal-300 mb-4">Parallax Motion Parameters</h3>
                  <div class="grid grid-cols-2 gap-4">
                      <div><label class="block text-sm font-medium text-gray-400 mb-1">Layers</label><input type="range" min="2" max="10" [value]="motionParallax().layers" (input)="updateMotionParallaxLayers($event)" class="w-full"></div>
                      <div><label class="block text-sm font-medium text-gray-400 mb-1">Separation</label>
                        <select [value]="motionParallax().separation" (change)="updateMotionParallaxSeparation($event)" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-sm text-white focus:ring-1 focus:ring-teal-500">
                          <option>subtle</option><option>moderate</option><option>deep</option>
                        </select>
                      </div>
                  </div>
              </div>
            }
            @if (selectedMotionType() === 'tilt_shift') {
              <div class="border-t border-gray-700/50 pt-4 animate-[fadeIn_0.5s_ease-in-out]">
                  <h3 class="text-lg font-medium text-teal-300 mb-4">Tilt-Shift Parameters</h3>
                  <div class="grid grid-cols-2 gap-4">
                      <div><label class="block text-sm font-medium text-gray-400 mb-1">Focal Plane Angle</label><input type="text" [value]="motionTiltShift().angle" (input)="updateMotionTiltShift('angle', $event)" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-sm"></div>
                      <div><label class="block text-sm font-medium text-gray-400 mb-1">Blur Intensity</label>
                        <select [value]="motionTiltShift().blur" (change)="updateMotionTiltShift('blur', $event)" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-sm text-white focus:ring-1 focus:ring-teal-500">
                          <option>light</option><option>moderate</option><option>strong</option>
                        </select>
                      </div>
                  </div>
              </div>
            }

            <div class="text-center pt-4">
              <button (click)="onGenerateMotionPrompt()"
                [disabled]="isLoading() || !motionSceneDescription().trim() || !selectedMotionType()"
                class="flex items-center mx-auto justify-center px-8 py-4 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 disabled:bg-purple-800 disabled:cursor-not-allowed disabled:text-gray-400 transition duration-200 shadow-md transform hover:scale-105 active:scale-100 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-gray-900">
                @if (isLoading()) {
                  <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                  <span>Generating Motion Prompt...</span>
                } @else {
                  <span>Generate Motion Prompt</span>
                }
              </button>
            </div>
          </div>
          
          @if (isLoading()) {
            <div class="text-center p-8"><div class="flex justify-center items-center space-x-2"><div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse [animation-delay:-0.3s]"></div><div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse [animation-delay:-0.15s]"></div><div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse"></div></div><p class="mt-4 text-gray-400">The AI is crafting your motion prompt...</p></div>
          }
          @if (error()) {
            <div class="bg-red-900/50 border border-red-700 text-red-300 px-4 py-3 rounded-lg" role="alert"><strong class="font-bold">Error: </strong><span class="block sm:inline">{{ error() }}</span></div>
          }
          @if (motionPromptOutput()) {
            <div class="bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg relative"><div class="p-6 sm:p-8"><div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-bold text-white">Your Generated Motion Prompt</h2><button (click)="copyToClipboard()" class="px-4 py-2 bg-gray-700 text-gray-300 font-semibold rounded-lg hover:bg-gray-600 transition duration-200 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">{{ copyButtonText() }}</button></div><div class="bg-gray-900 p-4 rounded-lg border border-gray-700"><p class="text-gray-300 whitespace-pre-wrap">{{ motionPromptOutput() }}</p></div></div></div>
          }
        </div>
      } @else {
          <!-- Main Input Section for Cinematic, Articulated, Photoreal -->
          <div class="space-y-8">
            <!-- Main Input Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
              
              <!-- Left Column: Core Idea -->
              <div class="lg:col-span-3">
                <div class="p-6 bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg h-full flex flex-col">
                  <label for="subject" class="block text-xl font-semibold text-purple-300 mb-3">1. Describe Your Core Idea</label>
                  <p class="text-sm text-gray-400 mb-4">Start with a simple concept. The AI will expand it into a full, detailed prompt.</p>
                  <textarea 
                      id="subject"
                      [value]="subject()"
                      (input)="updateSubject($event)"
                      placeholder="e.g., a futuristic cityscape at night, a medieval knight in shining armor, a photorealistic render of a new sneaker..."
                      class="w-full p-4 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition duration-200 flex-grow overflow-hidden"
                      rows="2"
                  ></textarea>
                </div>
              </div>

              <!-- Right Column: Infusion & Controls -->
              <div class="lg:col-span-2 space-y-6">
                <div class="p-6 bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg">
                  <label for="style-upload" class="block text-xl font-semibold text-purple-300 mb-3">2. Infuse a Style <span class="text-base font-normal text-gray-400">(Optional)</span></label>
                  <p class="text-sm text-gray-400 mb-4">Upload a reference image to guide the AI's aesthetic, color, and mood.</p>
                  <label for="style-upload" class="flex flex-col items-center justify-center w-full h-full min-h-[150px] border-2 border-gray-600 border-dashed rounded-lg cursor-pointer bg-gray-800 hover:bg-gray-700/50 transition-colors">
                      @if (styleReferenceImagePreview()) {
                          <img [src]="styleReferenceImagePreview()" alt="Style Preview" class="max-h-40 object-contain p-2 rounded-lg">
                      } @else {
                          <div class="flex flex-col items-center justify-center text-center p-2">
                              <svg class="w-10 h-10 mb-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14"></path></svg>
                              <p class="text-sm text-gray-400"><span class="font-semibold">Click to upload</span> or drag & drop</p>
                              <p class="text-xs text-gray-500">PNG, JPG, WEBP (MAX 5MB)</p>
                          </div>
                      }
                      <input id="style-upload" type="file" class="hidden" (change)="onStyleFileSelected($event)" accept="image/png, image/jpeg, image/webp">
                  </label>
                </div>
                
                <div class="p-6 bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg">
                  <h3 class="text-xl font-semibold text-purple-300 mb-4">3. Generation Mode</h3>
                  <div class="space-y-4">
                      <label for="copilot-toggle" class="flex items-center justify-between cursor-pointer w-full">
                        <span class="flex-col">
                          <span class="font-medium text-gray-200">AI Co-pilot</span>
                          <span class="text-xs text-gray-400 block">Let AI optimize the prompt for you.</span>
                        </span>
                        <div class="relative">
                          <input type="checkbox" id="copilot-toggle" class="sr-only" [checked]="aiCoPilotEnabled()" (change)="aiCoPilotEnabled.set($any($event.target).checked)">
                          <div class="block w-14 h-8 rounded-full transition-colors" [class.bg-purple-600]="aiCoPilotEnabled()" [class.bg-gray-600]="!aiCoPilotEnabled()"></div>
                          <div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform" [class.translate-x-6]="aiCoPilotEnabled()"></div>
                        </div>
                      </label>
                      <label for="concise-toggle" class="flex items-center justify-between cursor-pointer w-full">
                        <span class="flex-col">
                          <span class="font-medium text-gray-200">Concise Prompt</span>
                          <span class="text-xs text-gray-400 block">Generate a single paragraph (1900 chars).</span>
                        </span>
                        <div class="relative">
                          <input type="checkbox" id="concise-toggle" class="sr-only" [checked]="concisePromptEnabled()" (change)="concisePromptEnabled.set($any($event.target).checked)" [disabled]="aiCoPilotEnabled()">
                          <div class="block w-14 h-8 rounded-full transition-colors" [class.bg-purple-600]="concisePromptEnabled()" [class.bg-gray-600]="!concisePromptEnabled()" [class.cursor-not-allowed]="aiCoPilotEnabled()" [class.opacity-50]="aiCoPilotEnabled()"></div>
                          <div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform" [class.translate-x-6]="concisePromptEnabled()"></div>
                        </div>
                      </label>
                      <label for="advanced-toggle" class="flex items-center justify-between cursor-pointer w-full">
                        <span class="flex-col">
                          <span class="font-medium text-gray-200">Manual Controls</span>
                          <span class="text-xs text-gray-400 block">Manually add camera shots & audio.</span>
                        </span>
                        <div class="relative">
                          <input type="checkbox" id="advanced-toggle" class="sr-only" [checked]="showAdvanced()" (change)="showAdvanced.set($any($event.target).checked)" [disabled]="aiCoPilotEnabled() || concisePromptEnabled()">
                          <div class="block w-14 h-8 rounded-full transition-colors" [class.bg-purple-600]="showAdvanced()" [class.bg-gray-600]="!showAdvanced()" [class.cursor-not-allowed]="aiCoPilotEnabled() || concisePromptEnabled()" [class.opacity-50]="aiCoPilotEnabled() || concisePromptEnabled()"></div>
                          <div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform" [class.translate-x-6]="showAdvanced()"></div>
                        </div>
                      </label>
                    </div>
                </div>
              </div>
            </div>

            <!-- Generate Button -->
            <div class="text-center">
              <button 
                  (click)="onGenerate()"
                  [disabled]="isLoading() || !subject().trim()"
                  class="flex w-full sm:w-auto sm:mx-auto items-center justify-center px-12 py-4 bg-purple-600 text-white text-lg font-semibold rounded-lg hover:bg-purple-700 disabled:bg-purple-800 disabled:cursor-not-allowed disabled:text-gray-400 transition duration-200 shadow-lg shadow-purple-900/50 transform hover:scale-105 active:scale-100 focus:outline-none focus:ring-4 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-gray-900">
                  @if (isLoading()) {
                  <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                  <span>Generating...</span>
                  } @else {
                  <span>Generate Prompt</span>
                  }
              </button>
            </div>
          </div>
          
          <!-- Advanced Controls -->
          @if (showAdvanced()) {
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-8 animate-[fadeIn_0.5s_ease-in-out]">
              <!-- Camera Controls -->
              <div class="p-6 bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg">
                <h3 class="text-xl font-semibold text-teal-300 mb-4">Camera Controls</h3>
                <div class="h-64 overflow-y-auto pr-2 space-y-3">
                  @for (shot of cameraShots; track shot.name) {
                    <label class="flex items-start space-x-3 p-3 bg-gray-900/40 rounded-lg hover:bg-gray-800/60 transition-colors cursor-pointer">
                      <input type="checkbox" 
                            class="mt-1 form-checkbox h-5 w-5 text-teal-500 bg-gray-700 border-gray-600 rounded focus:ring-teal-500 focus:ring-2"
                            (change)="toggleCameraShot(shot.name, $event)">
                      <span class="flex flex-col">
                        <span class="font-medium text-gray-200">{{ shot.name }}</span>
                        <span class="text-sm text-gray-400">{{ shot.description }}</span>
                      </span>
                    </label>
                  }
                </div>
              </div>
              <!-- Audio Controls -->
              <div class="p-6 bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg">
                <h3 class="text-xl font-semibold text-teal-300 mb-4">Audio Controls</h3>
                <div class="space-y-4">
                  <div>
                    <label for="audio-mood" class="block text-sm font-medium text-gray-300 mb-1">Mood</label>
                    <input type="text" id="audio-mood" [value]="audioMood()" (input)="audioMood.set($any($event.target).value)" placeholder="e.g., tense, epic, mysterious" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-sm text-white placeholder-gray-500 focus:ring-1 focus:ring-teal-500">
                  </div>
                  <div>
                    <label for="audio-sfx" class="block text-sm font-medium text-gray-300 mb-1">Key Sound Effects</label>
                    <input type="text" id="audio-sfx" [value]="audioSfx()" (input)="audioSfx.set($any($event.target).value)" placeholder="e.g., footsteps, distant thunder, glitch sounds" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-sm text-white placeholder-gray-500 focus:ring-1 focus:ring-teal-500">
                  </div>
                  <div>
                    <label for="audio-music" class="block text-sm font-medium text-gray-300 mb-1">Music Style</label>
                    <input type="text" id="audio-music" [value]="audioMusic()" (input)="audioMusic.set($any($event.target).value)" placeholder="e.g., orchestral score, synthwave, ambient" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-sm text-white placeholder-gray-500 focus:ring-1 focus:ring-teal-500">
                  </div>
                </div>
              </div>
            </div>
          }
          
          <!-- Output Section -->
          <div class="w-full space-y-8 mt-12">
            @if (isLoading()) {
              <div class="text-center p-8">
                <div class="flex justify-center items-center space-x-2">
                  <div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse [animation-delay:-0.3s]"></div>
                  <div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse [animation-delay:-0.15s]"></div>
                  <div class="w-4 h-4 rounded-full bg-purple-400 animate-pulse"></div>
                </div>
                <p class="mt-4 text-gray-400">The AI is crafting your prompt...</p>
              </div>
            }

            @if (error()) {
              <div class="bg-red-900/50 border border-red-700 text-red-300 px-4 py-3 rounded-lg" role="alert">
                <strong class="font-bold">Error: </strong>
                <span class="block sm:inline">{{ error() }}</span>
              </div>
            }

            @if (coPilotOutput()) {
              @let parsed = parsedCoPilotOutput();
              <div class="bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg relative">
                <div class="p-6 sm:p-8">
                  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                    <h2 class="text-2xl font-bold text-white">AI Co-pilot Analysis</h2>
                    <button (click)="copyToClipboard()" 
                      class="px-4 py-2 bg-gray-700 text-gray-300 font-semibold rounded-lg hover:bg-gray-600 transition duration-200 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">
                        {{ copyButtonText() }}
                    </button>
                  </div>
                  
                  @if (parsed) {
                    <!-- Rich JSON view -->
                    <div class="space-y-6">
                      <div>
                        <h3 class="text-lg font-semibold text-purple-300">Optimized Prompt</h3>
                        <p class="mt-1 text-gray-300 bg-gray-900 p-3 rounded-md border border-gray-700 whitespace-pre-wrap">{{ parsed.outputPrompt }}</p>
                      </div>
                      <div>
                        <h3 class="text-lg font-semibold text-purple-300">Selected Camera Shots</h3>
                        <p class="mt-1 text-sm text-gray-400 italic">{{ parsed.cameraSettings.rationale }}</p>
                        <ul class="mt-2 list-disc list-inside space-y-1 pl-2">
                          @for (shot of parsed.cameraSettings.selected_shots; track shot) {
                            <li class="text-gray-300">{{ shot }}</li>
                          }
                        </ul>
                      </div>
                       <div class="border-t border-gray-700 pt-4">
                          <h3 class="text-lg font-semibold text-red-300">Auto Negative Prompt Analysis</h3>
                          <p class="mt-1 text-sm text-gray-400 italic">{{ parsed.negative_prompt_analysis.rationale }}</p>
                          <div class="mt-2 bg-red-900/20 border border-red-700/50 p-3 rounded-md">
                            <ul class="list-disc list-inside space-y-1 pl-2">
                              @for (neg of parsed.negative_prompt_analysis.negative_prompts; track neg) {
                                <li class="text-red-200">{{ neg }}</li>
                              }
                            </ul>
                          </div>
                      </div>
                    </div>
                  } @else {
                    <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto border border-gray-700"><code class="text-sm text-gray-300 whitespace-pre-wrap">{{ coPilotOutput() }}</code></pre>
                  }
                </div>
              </div>
            } @else if (promptSections().length > 0) {
              <div class="bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg relative">
                <div class="p-6 sm:p-8">
                  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                    <h2 class="text-2xl font-bold text-white">Your Generated Prompt</h2>
                    <div class="flex items-center gap-2 sm:gap-4 self-end sm:self-center">
                        @if (!concisePromptEnabled() && promptFormat() === 'json') {
                          <div class="flex items-center bg-gray-900/50 border border-gray-700 rounded-lg p-1 text-sm">
                            <button (click)="outputViewMode.set('text')" 
                                    class="px-3 py-1 rounded-md transition-colors duration-200 focus:outline-none"
                                    [class.bg-purple-600]="outputViewMode() === 'text'"
                                    [class.text-white]="outputViewMode() === 'text'"
                                    [class.text-gray-300]="outputViewMode() !== 'text'"
                                    [class.hover:bg-gray-700]="outputViewMode() !== 'text'">
                                Text
                            </button>
                            <button (click)="outputViewMode.set('json')" 
                                    class="px-3 py-1 rounded-md transition-colors duration-200 focus:outline-none"
                                    [class.bg-purple-600]="outputViewMode() === 'json'"
                                    [class.text-white]="outputViewMode() === 'json'"
                                    [class.text-gray-300]="outputViewMode() !== 'json'"
                                    [class.hover:bg-gray-700]="outputViewMode() !== 'json'">
                                JSON
                            </button>
                          </div>
                        }
                        <button (click)="copyToClipboard()" 
                          class="px-4 py-2 bg-gray-700 text-gray-300 font-semibold rounded-lg hover:bg-gray-600 transition duration-200 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">
                            {{ copyButtonText() }}
                        </button>
                    </div>
                  </div>
                  
                  @if(concisePromptEnabled() || outputViewMode() === 'text') {
                    <div class="space-y-4">
                      @for (section of activePromptSections(); track section.title) {
                        <div class="border-l-4 border-purple-500 pl-4">
                          <h3 class="text-lg font-semibold text-purple-300">{{ section.title }}</h3>
                          <p class="text-gray-300 whitespace-pre-wrap">{{ section.content }}</p>
                        </div>
                      }
                    </div>
                  } @else {
                    <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto border border-gray-700"><code class="text-sm text-gray-300 whitespace-pre-wrap">{{ jsonPrompt() }}</code></pre>
                  }
                </div>
              </div>

              <!-- Refinement Section -->
              <div class="p-6 bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg">
                <h3 class="text-xl font-semibold text-purple-300 mb-3">Refine Your Prompt</h3>
                <p class="text-sm text-gray-400 mb-4">Provide a simple instruction to modify the generated prompt above.</p>
                <div class="flex flex-col sm:flex-row gap-4">
                  <textarea 
                    [value]="refinementInstruction()"
                    (input)="updateRefinementInstruction($event)"
                    placeholder="e.g., 'make the lighting more dramatic', 'change the setting to a futuristic city', 'add a sense of urgency'"
                    class="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition duration-200 flex-grow overflow-hidden"
                    rows="1"
                  ></textarea>
                  <button 
                    (click)="onRefine()"
                    [disabled]="isRefining() || !refinementInstruction().trim()"
                    class="flex items-center justify-center px-6 py-2 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 disabled:bg-purple-800 disabled:cursor-not-allowed transition duration-200 flex-shrink-0">
                    @if (isRefining()) {
                      <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                      <span>Refining...</span>
                    } @else {
                      <span>Refine</span>
                    }
                  </button>
                </div>
              </div>

              <!-- Workspace Section -->
              <div class="p-6 bg-gray-800/50 rounded-xl border border-gray-700 shadow-lg">
                  <h2 class="text-2xl font-bold text-white mb-6">Creative Workspace</h2>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                      <!-- Image Generation -->
                      <div class="space-y-4">
                          <h3 class="text-xl font-semibold text-teal-300">Generate a Concept Image</h3>
                          <div class="flex flex-col sm:flex-row gap-4">
                              <select [value]="imageAspectRatio()" (change)="imageAspectRatio.set($any($event.target).value)" class="bg-gray-700 border-gray-600 rounded-md p-2 text-sm text-white focus:ring-1 focus:ring-teal-500">
                                  @for (ratio of aspectRatios; track ratio) {
                                      <option [value]="ratio">Aspect {{ ratio }}</option>
                                  }
                              </select>
                              <button (click)="onGenerateImage()" 
                                      [disabled]="isGeneratingImage()"
                                      class="flex-1 flex items-center justify-center px-4 py-2 bg-teal-600 text-white font-semibold rounded-lg hover:bg-teal-700 disabled:bg-teal-800 disabled:cursor-not-allowed transition duration-200">
                                  @if (isGeneratingImage()) {
                                      <svg class="animate-spin -ml-1 mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg>
                                      <span>Generating...</span>
                                  } @else {
                                      <span>Generate</span>
                                  }
                              </button>
                          </div>
                          @if (imageGenerationError()) { <p class="text-sm text-red-400">{{ imageGenerationError() }}</p> }
                      </div>
                      <!-- Image Display and Upscaling -->
                      <div class="space-y-4">
                          <div class="aspect-square bg-gray-900/50 rounded-lg border border-gray-700 flex items-center justify-center overflow-hidden">
                              @if (isGeneratingImage() || isUpscalingImage()) {
                                <div class="flex flex-col items-center text-gray-400">
                                    <svg class="animate-spin h-8 w-8 text-teal-400 mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg>
                                    <span>{{ isUpscalingImage() ? 'Upscaling...' : 'Generating...' }}</span>
                                </div>
                              } @else if (generatedImageUrl()) {
                                  <img [src]="generatedImageUrl()" alt="Generated Concept Image" class="w-full h-full object-contain">
                              } @else {
                                  <p class="text-gray-500">Image will appear here</p>
                              }
                          </div>
                          <button (click)="onUpscaleImage()" [disabled]="!generatedImageUrl() || isUpscalingImage() || isGeneratingImage()" class="w-full px-4 py-2 bg-teal-600 text-white font-semibold rounded-lg hover:bg-teal-700 disabled:bg-teal-800 disabled:cursor-not-allowed transition duration-200">Upscale to 4K</button>
                           @if (upscaleImageError()) { <p class="text-sm text-red-400">{{ upscaleImageError() }}</p> }
                      </div>
                  </div>
              </div>
            }
          </div>
      }
    </div>
  </div>
</main>
